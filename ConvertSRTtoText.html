<!DOCTYPE html>
<html>
<head>
	<title>Convert Srt to Text</title>
</head>
<body>
	<h1>Convert Srt to Text</h1>
	<form id="form">
		<label for="inputFile">Input File:</label>
		<input type="file" id="inputFile" accept=".srt" required>
		<br>
		<label for="preview">Preview:</label>
		<textarea id="preview" rows="10" cols="50" readonly></textarea>
		<br>
		<label for="downloadFile">Download Output File:</label>
		<button type="button" id="downloadFile">Download</button>
	</form>
	<script>
		// 绑定事件监听器，选择文件后自动加载文件内容
		document.getElementById("inputFile").addEventListener("change", function() {
			var reader = new FileReader();
			reader.onload = function() {
				document.getElementById("preview").value = convertSrtToText(reader.result);
			};
			reader.readAsText(this.files[0]);
		});

		// 绑定事件监听器，点击下载按钮后下载文件
		document.getElementById("downloadFile").addEventListener("click", function() {
			var inputFileName = document.getElementById("inputFile").value.split(/(\\|\/)/g).pop();
			var outputFileName = inputFileName.replace(".srt", ".txt");
			var outputContent = document.getElementById("preview").value;
			download(outputFileName, outputContent);
		});

		// SRT转换为文本
		function convertSrtToText(srt) {
			var lines = srt.trim().split(/[\r\n]+/);
			var output = "";
			for (var i = 0; i < lines.length; i++) {
				var line = lines[i].trim();
				// 如果是序号或时间码，跳过
				if (line.match(/^\d+$/) || line.match(/^\d{2}:\d{2}:\d{2},\d{3}\s+-->\s+\d{2}:\d{2}:\d{2},\d{3}$/) || line === "") {
					continue;
				}
				output += line + "\n";
			}
			return output;
		}

		// 下载文件
		function download(filename, text) {
			var element = document.createElement('a');
			element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
			element.setAttribute('download', filename);
			element.style.display = 'none';
			document.body.appendChild(element);
			element.click();
			document.body.removeChild(element);
		}
	</script>
</body>
</html>
